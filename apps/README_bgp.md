# BGP simulation

`bgp` application is a realistic example about BGP simulation by using `sarasate`. 

## Whatâ€™s the BGP simulation? 

We are mimicking the behavior of the BGP speaker as it receives announcement from their neighbors. Then, the BGP speaker will be going to reapply its policy to update its current best path. This update will be essentially implemented as a `sarasate` join. 

## Data Source

[RouteView](http://archive.routeviews.org/bgpdata/): MRT format RIBs and UPDATEs from route-views2.oregon-ix.net(2021.06.10 00:00)

## Key Tables
- `bgp_policy`: BGP policy generated from RIB file including three types of policies: 
    * Shortest Path Policy.
    * Static Routes Policy.
    * Filter Policy.
- `current_best_routes`: Current best routes are generated by joining bgp policy and candidate routes(inferred from RIB file). 
- `routes_delta`: BGP announcement is generated from UPDATE file.

## Walkthrough

1. Run Faure system with `--onlydb` mode and enter in bgp terminal.
   
    ```bash
    $ sudo python3 ravel.py --onlydb

    $ravel> bgp
    ```

2. Load typical data .
   
    ```bash
    $bgp> loaddemo
    ```

3. Update BGP policy because the entering routes affect the way the current policy implemented.

    ```bash
    $bgp> update_policy bgp_policy routes_delta
    ```

4. Generate new candidate routes by union current best routes and BGP announcements. It is stored in `new_routes` table.

    ```bash
    $bgp> union current_best_routes routes_delta
    ```

5. Get the new best routes by using sarasate join bgp policy and new candidate routes.
   
    ```bash
    $bgp> select * from bgp_policy, new_routes where bgp_policy.dest = new_routes.dest and bgp_policy.path = new_routes.path;
    ```
